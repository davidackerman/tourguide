# Analysis Mode - Enhanced Features

## Overview

The analysis mode now includes comprehensive session tracking, timing information, and result management - similar to the recording sessions feature.

## New Features

### 1. Session Metadata Tracking

Each analysis session now saves detailed metadata including:
- **Query**: Original user query
- **Generated Code**: Full Python code generated by AI
- **Execution Results**: stdout, stderr, and generated plots
- **Timing Information**: Breakdown of code generation and execution time
- **Status**: Success/error status

Metadata is saved to `analysis_results/{session_id}/metadata.json`.

### 2. Timing Breakdown

All analysis requests now track timing with millisecond precision:
- **Code Generation Time**: Time to generate Python code from natural language query
- **Execution Time**: Time to run code in container sandbox
- **Total Time**: End-to-end processing time

Example timing output:
```json
{
  "timing": {
    "code_generation_seconds": 0.523,
    "execution_seconds": 2.451,
    "total_seconds": 2.974
  }
}
```

### 3. New API Endpoints

#### List Sessions
**GET** `/api/analysis/sessions?limit=50`

Lists recent analysis sessions sorted by creation time (newest first).

#### Get Session Details
**GET** `/api/analysis/session/{session_id}`

Gets full details for a specific session including code, results, and plots.

### 4. Enhanced Analysis Response

The `/api/analysis/ask` endpoint now returns timing information.

## Testing

Run the test script to verify the API:
```bash
pixi run python test_analysis_api.py
```
